<properties 
	pageTitle="自動調整和 App Service 環境" 
	description="自動調整和 App Service 環境" 
	services="app-service"
	documentationCenter=""
	authors="btardif" 
	manager="wpickett" 
	editor="" 
/>

<tags 
	ms.service="app-service" 
	ms.workload="web" 
	ms.tgt_pltfrm="na" 
	ms.devlang="na" 
	ms.topic="article" 
	ms.date="03/01/2016" 
	ms.author="byvinyal"
/>
	
#自動調整和 App Service 環境

##簡介
**App Service 環境**支援自動調整。達成方式是讓您根據計量或排程自動調整個別背景工作集區。
 
![][intro]
 
自動調整可讓您將資源使用量最佳化，方法是透過自動增加或縮減 **App Service 環境**以符合您的預算和或負載設定檔。

##設定背景工作集區自動調整 
您可以從 [背景工作集區] 的 [設定] 索引標籤存取自動調整功能。
 
![][settings-scale]

從該處的介面應相當熟悉，因為這是與調整 **App Service 方案**時相同的體驗。您將可以手動輸入調整值
 
![][scale-manual]
 
或設定自動調整設定檔：
 
![][scale-profile]
 
自動調整設定檔對於設定您的規模的限制很實用。如此一來，您可以同時藉由設定下限調整值 (1) 獲得一致的效能體驗和藉由設定上限 (2) 獲得可預測的資本支出。
 
![][scale-profile2]
 
定義設定檔之後，可以加入度量式自動調整規則，以相應增加或減少設定檔所定義的範圍內**背景工作集區**中的執行個體數目。

![][scale-rule]

 任一個**背景工作集區**或**前端**度量可以用來定義自動調整規則。這些是您可以在資源刀鋒視窗圖形中監視或設定警示的相同度量。
 
##自動調整範例
**App Service 環境**的自動調整可使用逐步解說一個案例來加以說明。在本文中，我將導覽設定自動調整時的所有必要考量，以及在我們納入 **App Service 環境** ASE 所裝載的自動調整時派上用場的所有互動。

###案例簡介
Frank 是企業的系統管理員，他已將所負責的部分工作量移轉至 **App Service 環境**。

**App Service 環境**設為以如下方式手動調整：
* 前端：3
* 背景工作角色集區 1：10
* 背景工作角色集區 2：5
* 背景工作角色集區 3：5

**背景工作集區 1** 是用於生產工作負載，而**背景工作集區 2** 和**背景工作集區3** 用於品管及開發工作負載。

用於品管 QA 和開發的 **App Service 方案**都針對**手動調整**設定，但生產 **App Service 方案**則設為**自動調整**以處理負載和流量的變化。

Frank 很熟悉應用程式，並且他知道負載尖峰時段是上午 9:00 到下午 6:00 之間，因為這是 **LOB 應用程式**並且是由員工在辦公室時使用。之後使用量會下降，就是在使用者下班時。但仍有一些負載，因為使用者可以使用其行動裝置或家用電腦自遠端存取。生產 **App Service 方案** 已利用下列規則設定為根據 CPU 使用量**自動調整**：

![][asp-scale]

|	**自動調整設定檔 - 工作日 - App Service 方案** |	**自動調整設定檔 - 週末 - App Service 方案** |
|	----------------------------------------------------	|	----------------------------------------------------	|
|	**名稱：**工作日設定檔 |	**名稱：**週末設定檔 |
|	**調整規模：**排程和效能規則 |	**調整規模：**排程和效能規則 |
|	**設定檔：**工作日 |	**設定檔：**週末 |
|	**類型：**循環 |	**類型：**循環 |
|	**目標範圍：**5 到 20 個執行個體 |	**目標範圍：**3 到 10 個執行個體 |
|	**星期幾：**星期一、星期二、星期三、星期四、星期五 |	**星期幾：**星期六、星期日 |
|	**開始時間：**上午 9:00 |	**開始時間：**上午 9:00 |
|	**時區：**UTC - 08 |	**時區：**UTC - 08 |
| | |
|	**自動調整規則 (相應增加)** |	**自動調整規則 (相應增加)** |
|	**資源：**生產環境 (App Service 環境) |	**資源：**生產環境 (App Service 環境) |
|	**度量：**CPU % |	**度量：**CPU % |
|	**作業：**大於 60% |	**作業：**大於 80% |
|	**持續時間：**5 分鐘 |	**持續時間：**10 分鐘 |
|	**時間彙總：**平均 |	**時間彙總：**平均 |
|	**動作：**計數增加 2 |	**動作：**計數增加 1 |
|	**冷卻時間 (分鐘)：**15 |	**冷卻時間 (分鐘)：**20 |
| | |
|	**自動調整規則 (相應減少)** |	**自動調整規則 (相應減少)** |
|	**資源：**生產環境 (App Service 環境) |	**資源：**生產環境 (App Service 環境) |
|	**度量：**CPU % |	**度量：**CPU % |
|	**作業：**少於 30% |	**作業：**少於 20% |
|	**持續時間：**10 分鐘 |	**持續時間：**15 分鐘 |
|	**時間彙總：**平均 |	**時間彙總：**平均 |
|	**動作：**計數減少 1 |	**動作：**計數減少 1 |
|	**冷卻時間 (分鐘)：**20 |	**冷卻時間 (分鐘)：**10 |

###App Service 方案擴大率
設定為自動調整的 **App Service 方案**，就會以每小時最大的速率進行。此速率可以根據自動調整規則上提供的值計算。

了解及計算 **App Service 方案擴大率**對 **App Service 環境** **背景工作集區**自動調整來說很重要，因為**背景工作集區**的調整變更並非瞬間完成，需要一些時間才能套用。

**App Service 方案**擴大率的計算方式如下：

![][ASP-Inflation]

根據生產 **App Service 方案**的*工作日*設定檔的*自動調整 - 相應增加*規則，這看起來會是如下：

![][Equation1]

如果是生產 **App Service 方案**的*週末*設定檔的*自動調整 - 相應增加*規則，公式會解析為：

![][Equation2]

此值也可以針對相應減少作業計算：

根據生產 **App Service 方案**的*工作日*設定檔的*自動調整 - 相應減少*規則，這看起來會是如下：

![][Equation3]

如果是生產 **App Service 方案**的*週末*設定檔的*自動調整 - 相應減少*規則，公式會解析為：

![][Equation4]

這表示生產 **App Service 方案**能在週間以每小時 **8** 個執行個體，以及在週末期間以每小時 **4** 個執行個體的最大速率成長。而它能夠在週間以每小時 **4** 個執行個體，以及在週末期間以每小時 **6** 個執行個體的最大速率釋出執行個體。

如果在**背景工作角色集區**中裝載多個 **App Service 方案**，則需要計算**總擴大率**，而且這可以表示為裝載在該**背景工作角色集區**中的所有 **App Service 方案**的擴大率*總和*。

![][ASP-Total-Inflation]

###使用 App Service 方案擴大率來定義背景工作集區自動調整規則
主控 **App Service 方案**且設定為自動調整的**背景工作集區**，必須配置有容量緩衝區以在需要時允許自動調整作業增加/縮減 **App Service 方案**。最小緩衝區會計算為**總計 App Service 方案擴大率**。

由於 **App Service 環境**調整作業需要一些時間才能套用，任何變更應該考量當調整正在進行時可能會發生的進一步需求變更。基於此原因，我們建議使用計算的**總計 App Service 方案擴大率**作為對每個自動調整作業加入的執行個體數目下限。

使用此資訊，Frank 可以定義下列的自動調整設定檔和規則

![][Worker-Pool-Scale]

|	**自動調整設定檔 - 工作日** |	**自動調整設定檔 - 週末** |
|	----------------------------------------------------	|	--------------------------------------------	|
|	**名稱：**工作日設定檔 |	**名稱：**週末設定檔 |
|	**調整規模：**排程和效能規則 |	**調整規模：**排程和效能規則 |
|	**設定檔：**工作日 |	**設定檔：**週末 |
|	**類型：**循環 |	**類型：**循環 |
|	**目標範圍：**13 到 25 個執行個體 |	**目標範圍：**6 到 15 個執行個體 |
|	**星期幾：**星期一、星期二、星期三、星期四、星期五 |	**星期幾：**星期六、星期日 |
|	**開始時間：**上午 7:00 |	**開始時間：**上午 9:00 |
|	**時區：**UTC - 08 |	**時區：**UTC - 08 |
| | |
|	**自動調整規則 (相應增加)** |	**自動調整規則 (相應增加)** |
|	**資源：**背景工作集區 1 |	**資源：**背景工作集區 1 |
|	**度量：**WorkersAvailable |	**度量：**WorkersAvailable |
|	**作業：**少於 8 |	**作業：**少於 3 |
|	**持續時間：**20 分鐘 |	**持續時間：**30 分鐘 |
|	**時間彙總：**平均 |	**時間彙總：**平均 |
|	**動作：**計數增加 8 |	**動作：**計數增加 3 |
|	**冷卻時間 (分鐘)：**180 |	**冷卻時間 (分鐘)：**180 |
| | |
|	**自動調整規則 (相應減少)** |	**自動調整規則 (相應減少)** |
|	**資源：**背景工作集區 1 |	**資源：**背景工作集區 1 |
|	**度量：**WorkersAvailable |	**度量：**WorkersAvailable |
|	**作業：**大於 8 |	**作業：**大於 3 |
|	**持續時間：**20 分鐘 |	**持續時間：**15 分鐘 |
|	**時間彙總：**平均 |	**時間彙總：**平均 |
|	**動作：**計數減少 2 |	**動作：**計數減少 3 |
|	**冷卻時間 (分鐘)：**120 |	**冷卻時間 (分鐘)：**120 |

設定檔中定義的目標範圍的計算方式是由設定檔中為 **App Service 方案**定義的最小執行個體 + 緩衝區。

最大值範圍是裝載於**背景工作集區**的所有 **App Service 方案**最大範圍的總和。

相應增加規則的增加計數應該設定為至少是 **App Service 方案擴大率**的一倍進行相應增加。

減少計數可以調整成介於 **App Service 方案擴大率**的一半或一倍之間進行相應減少。

###前端集區的自動調整
**前端**自動調整規則會比**背景工作集區**簡單，要尋找的主要項目是要確定測量的持續時間，而冷卻計時器會將 **App Service 方案**的調整作業不是瞬間完成事實納入考量。

在此案例中，Frank 知道當前端達到 80% 的 CPU 使用量時錯誤率會增加，為了防止此情況，他設定自動調整規則來增加執行個體，如下所示：
 
![][Front-End-Scale]
  
|	**自動調整設定檔 - 前端** |
|	--------------------------------------------	|
|	**名稱：**自動調整 - 前端 |
|	**調整規模：**排程和效能規則 |
|	**設定檔：**每日 |
|	**類型：**循環 |
|	**目標範圍：**3 到 10 個執行個體 |
|	**星期幾：**每日 |
|	**開始時間：**上午 9:00 |
|	**時區：**UTC - 08 |
| |
|	**自動調整規則 (相應增加)** |
|	**資源：**前端集區 |
|	**度量：**CPU % |
|	**作業：**大於 60% |
|	**持續時間：**20 分鐘 |
|	**時間彙總：**平均 |
|	**動作：**計數增加 3 |
|	**冷卻時間 (分鐘)：**120 |
| |
|	**自動調整規則 (相應減少)** |
|	**資源：**背景工作集區 1 |
|	**度量：**CPU % |
|	**作業：**少於 30% |
|	**持續時間：**20 分鐘 |
|	**時間彙總：**平均 |
|	**動作：**計數減少 3 |
|	**冷卻時間 (分鐘)：**120 |

<!-- IMAGES -->
[intro]: ./media/app-service-environment-auto-scale/introduction.png
[settings-scale]: ./media/app-service-environment-auto-scale/settings-scale.png
[scale-manual]: ./media/app-service-environment-auto-scale/scale-manual.png
[scale-profile]: ./media/app-service-environment-auto-scale/scale-profile.png
[scale-profile2]: ./media/app-service-environment-auto-scale/scale-profile-2.png
[scale-rule]: ./media/app-service-environment-auto-scale/scale-rule.png
[asp-scale]: ./media/app-service-environment-auto-scale/asp-scale.png
[ASP-Inflation]: ./media/app-service-environment-auto-scale/asp-inflation-rate.png
[Equation1]: ./media/app-service-environment-auto-scale/equation1.png
[Equation2]: ./media/app-service-environment-auto-scale/equation2.png
[Equation3]: ./media/app-service-environment-auto-scale/equation3.png
[Equation4]: ./media/app-service-environment-auto-scale/equation4.png
[ASP-Total-Inflation]: ./media/app-service-environment-auto-scale/asp-total-inflation-rate.png
[Worker-Pool-Scale]: ./media/app-service-environment-auto-scale/wp-scale.png
[Front-End-Scale]: ./media/app-service-environment-auto-scale/fe-scale.png

<!---HONumber=AcomDC_0302_2016-->