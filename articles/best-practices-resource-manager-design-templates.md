<properties
	pageTitle="設計 Azure 資源管理員範本的最佳做法"
	description="顯示 Azure 資源管理員範本的設計模式"
	services="azure-resource-manager"
	documentationCenter=""
	authors="mmercuri"
	manager="georgem"
	editor="tysonn"/>

<tags
	ms.service="azure-resource-manager"
	ms.workload="multiple"
	ms.tgt_pltfrm="na"
	ms.devlang="na"
	ms.topic="article"
	ms.date="07/15/2015"
	ms.author="mmercuri"/>

# 設計 Azure 資源管理員範本的最佳做法

在與企業、系統整合者 (SI)、雲端服務廠商 (CSV) 和開放原始碼軟體 (OSS) 專案小組合作時，經常需要快速部署環境、工作負載或縮放單位。這些部署需要受到支援、依照經過實證的做法執行，並遵循所識別的原則。根據 Azure 資源管理員範本來使用彈性的方法，您可以快速且一致地部署複雜的拓撲，然後隨著核心供應項目的發展輕鬆調整這些部署，或是適應極端案例或客戶的變化。

範本會結合基礎 Azure 資源管理員的優點，以及 JavaScript 物件標記法 (JSON) 的適應性和可讀性。使用範本，您可以：

- 以一致的方式部署拓撲及其工作負載。
- 使用資源群組，一併管理應用程式中的所有資源。
- 套用角色型存取控制 (RBAC)，以授與使用者、群組和服務適當的存取權限。
- 使用標記關聯來簡化工作，例如計費彙總套件。

本文提供在我們的設計工作階段以及真實世界中與 Azure 客戶諮詢小組 (AzureCAT) 客戶進行範本實作過程中所識別的取用案例、架構及實作模式的詳細資訊。姑且不論學術理論為何，這些都是透過針對 12 個以 Linux 為基礎的頂尖 OSS 技術開發之範本所通知且經過實證的最佳做法，包括： Apache Kafka、Apache Spark、Cloudera、Couchbase、Hortonworks HDP、Apache Cassandra 提供的 DataStax Enterprise、Elasticsearch、Jenkins、MongoDB、Nagios、PostgreSQL、Redis 及 Nagios。這其中大部分的範本都是透過指定散發套件的知名廠商所開發，並且在最近使用的專案期間受到 Microsoft 企業和 SI 客戶的需求所影響。

本文將分享這些經過實證的最佳做法，以協助您設計世界級 Azure 資源管理員範本。

透過與客戶合作，我們已在企業、系統整合者和 CSV 之間識別出許多資源管理員範本取用體驗。下列各節提供適用於不同客戶類型的常見案例和模式的整體概觀。

## 企業和系統整合者

在大型組織中，我們常看到兩種 ARM 範本的取用者：內部軟體開發團隊和公司 IT。我們曾經合作過的 SI 案例可對應到企業中的相同職位，因此可套用相同的考量。

### 內部軟體開發團隊

如果您的團隊會開發軟體來支援企業，則範本讓您能夠輕鬆快速地部署可用於企業特定解決方案的技術。您也可以使用範本快速建立訓練環境，讓團隊成員能夠取得所需的技巧。

您可以依原樣使用範本，或者擴充或撰寫它們來符合您的需求。在範本內使用標記，您可以利用各種不同的檢視 (例如，團隊、專案、個人及教育) 來提供帳單摘要。

企業通常希望軟體開發團隊能夠建立範本來部署一致性解決方案，同時還能提供限制，使得該環境中的特定項目會維持固定不變且無法覆寫。例如，銀行可能需要包含 RBAC 的範本，讓程式設計師無法修訂銀行解決方案來將資料傳送到個人的儲存體帳戶。

### 公司 IT

公司 IT 組織通常會使用範本來傳遞雲端容量和雲端裝載功能。

#### 雲端容量

公司 IT 群組常用來為組織中的團隊提供雲端容量的方式是使用「T 恤尺寸」，也就是標準供應項目的大小 (例如，小型、 中型和大型)。T 恤尺寸的供應項目可以混合不同的資源類型和數量，同時提供標準化層級，讓您能夠使用範本。範本會利用一致性方式來提供容量，強制執行公司原則，並使用標記來為取用組織提供帳單。

例如，您可能需要提供開發、測試或實際執行環境，讓軟體開發團隊可以在其中部署他們的解決方案。環境具有軟體開發團隊無法變更的預先定義網路拓樸和項目，例如，用來管理公用網際網路的存取以及封包檢查的規則。您也可以針對這些環境，使用不同的環境存取權限來設定組織特定的角色。

#### 雲端裝載功能

您可以使用範本來支援雲端裝載功能，包括個別的軟體套件，或是提供給內部特定業務的複合供應項目。複合供應項目的一個範例是，在預先定義的網路拓撲上，利用最佳化且已連接的組態來提供的「分析即為服務」(分析、視覺化和其他技術)。

雲端裝載功能會受到建置它們的雲端容量供應項目所建立的安全性和角色考量所影響，如上所述。這些功能會依原樣提供，或提供來做為受管理的服務。針對後者，需要具備受到存取限制的角色，才能基於管理目的啟用環境的存取。

## 雲端服務廠商

在討論許多 CSV 之後，我們找出了多個方法，讓您能夠用來針對客戶及相關聯需求部署服務。

### CSV 裝載的供應項目

如果您在自己的 Azure 訂用帳戶中裝載您供應項目，則有兩種常見的裝載方法：針對每位客戶部署不同的部署，或部署縮放單位來支持針對所有客戶使用的共用基礎結構。

- **針對每位客戶進行不同的部署。** 針對每位客戶進行不同的部署，需要具備不同已知組態的固定拓撲。這些可能會有不同的虛擬機器 (VM) 大小、各種不同的節點數目，以及不同的相關聯儲存體數量。部署的標記可用來彙總每位客戶的帳單。系統可能會啟用 RBAC，以允許客戶存取其雲端環境的各個層面。
- **共用多租用戶環境中的縮放單位。** 範本可以代表多租用戶環境的縮放單位。在此情況下，相同的基礎結構可用來支援所有客戶。部署代表一組可針對所裝載供應項目提供容量層級的資源，例如，使用者人數和交易數目。這些縮放單位會隨著需求增加或減少。

### CSV 供應項目會插入至客戶訂用帳戶

您可能想要將軟體部署到客戶所擁有的訂用帳戶。您可以使用範本，部署不同的部署到客戶的 Azure 訂用帳戶。

這些部署會使用 RBAC，因此，您可以在客戶的帳戶內更新和管理部署。

### Azure Marketplace

如果您想要透過 Marketplace (例如 Azure Marketplace) 廣告和銷售您的供應項目，您可以開發範本，以提供不同類型且將在客戶的 Azure 帳戶中執行的部署。這個不同的部署通常可稱為 T 恤尺寸 (小型、中型、大型)、產品/對象類型 (社群、開發人員、企業) 或功能類型 (基本、高可用性)。在某些情況下，這些類型將允許您指定某些部署屬性，例如 VM 類型或磁碟數目。

## OSS 專案

在開放原始碼專案中，資源管理員範本讓社群能夠使用經過證實的做法，快速部署解決方案。您可以在 GitHub 儲存機制中儲存範本，讓社群可在經過一段時間之後修改它們。使用者接著可在自己的 Azure 訂用帳戶中部署這些範本。

下列各節將識別您在設計解決方案之前需考慮的事項。

## 識別 VM 內部和外部的功能

設計範本時，最好考量虛擬機器 (VM) 內部與外部的相關功能需求：

- 外部表示您部署的 VM 和其他資源，例如，網路拓樸、標記、憑證/密碼的參考，以及角色型存取控制。所有的這些資源都是您範本的一部分。
- 內部表示已安裝的軟體和整體的期望狀態組態。其他機制 (例如 VM 延伸模組或指令碼) 可完整使用或部分使用。範本或許能夠識別和執行這些機制，但這些機制並不存在於範本中。

您可以在「箱子內部」進行的常見活動範例包括如下：

- 安裝或移除伺服器角色和功能
- 在節點或叢集層級安裝和設定軟體
- 在 Web 伺服器上部署網站
- 部署資料庫結構描述
- 管理登錄或其他類型的組態設定
- 管理檔案和目錄
- 啟動、停止及管理處理程序和服務
- 管理本機群組和使用者帳戶
- 安裝和管理封裝 (.msi、.exe、yum 等等)
- 管理環境變數
- 執行原生指令碼 (Windows PowerShell、bash 等)

### 期望狀態組態 (DSC)

考慮部署以外的 VM 內部狀態，您想要確定這個部署不會從已定義並簽入原始檔控制的組態中「漂移」。這可確保您的開發人員或操作人員不會對未在原始檔控制中驗證、測試或記錄的環境手動變更臨機操作。這點很重要，因為手動變更不是在原始檔控制中進行的，它們也不是標準部署的一部分，而且將影響軟體未來的自動化部署。

從安全性觀點來看，除了您的內部員工，期望狀態組態也很重要。駭客會定期嘗試洩漏和惡意探索軟體系統。如果成功，通常就會安裝檔案，否則會變更遭入侵的系統狀態。您可以利用期望狀態組態，來識別期望與實際狀態之間的差異，並還原已知的組態。

針對適用於 DSC 的最熱門機制有一些資源擴充功能可供使用 - PowerShell DSC、Chef 及 Puppet。這其中每一種都能部署 VM 的初始狀態，也可以用來確定會維持期望狀態。

## 通用範本範圍

在我們的經驗中，我們看到了範圍所浮現的三個主要解決方案範本。以下將詳細說明這三個範圍：容量、功能和端對端解決方案。

### 容量範圍

容量範圍可在標準拓樸中提供一組預先設定來遵循法規和原則的資源。最常見的範例是在企業 IT 或 SI 案例中部署標準開發環境。

### 功能範圍

功能範圍著重於部署和設定特定技術的拓撲。常見案例包括像是 SQL Server、Cassandra、Hadoop 等技術。

### 端對端解決方案範圍

端對端解決方案範圍的目標已超越單一功能，並改為將重點放在提供由多個功能所組成的端對端解決方案。

已設定解決方案範圍的範本範圍會將其本身顯示為一組具有一或多個已設定功能範圍的範本，其中含有解決方案特定的資源、邏輯和期望狀態。已設定解決方案範圍的範本範例之一是端對端資料管線解決方案範本，其中可能會將解決方案特定的拓撲和狀態與多個已設定功能範圍的解決方案範本混合在一起，例如 Kafka、Storm 及 Hadoop。

## 選擇自由格式與已知的組態

您一開始可能認為範本應該為取用者提供最大的彈性，但有許多考量會影響是否使用自由格式組態與已知組態的選擇。本節將識別主要的客戶需求，以及形成本文分享之處理方式的技術考量。

### 自由格式組態

表面上，自由格式組態聽起來很實用。它們讓您能夠選取 VM 類型，且提供任意數目的節點以及這些節點的連接磁碟，並做為範本的參數來執行此動作。不過，當您進一步查看並考慮將部署多個不同大小之虛擬機器的範本時，會出現其他考量，讓該選擇在許多案例中變得較不適當。

在 Azure 網站的 [適用於 Azure 的虛擬機器和雲端服務大小](http://msdn.microsoft.com/library/azure/dn641267.aspx)文章中，已識別出不同的 VM 類型和可用大小，以及每個可連接且持久的磁碟數目 (2、4、8、16 或 32)。每個連接的磁碟可提供 500 個 IOPS，而您可以利用這個 IOPS 數目做為乘數來共用這些磁碟數目的倍數。例如，共用 16 個磁碟，即可提供 8,000 個 IOPS。您可以使用 Microsoft Windows 儲存空間或 Linux 中價格便宜的獨立磁碟容錯陣列 (RAID)，利用作業系統中的組態來完成共用。

自由格式組態能夠選取一些 VM 執行個體、一些適用於這些執行個體的不同 VM 類型和大小、一些可根據 VM 類型而有所不同的磁碟，以及一或多個指令碼來設定 VM 內容。

通常，部署可能會有多種類型的節點 (例如主要和資料節點)，因此，經常會針對每個節點類型提供此彈性。

當您開始部署具有任何重要性的叢集時，就會開始使用這所有數目的倍數。例如，如果您正在部署 Hadoop 叢集，其中有 8 個主要節點和 200 個資料節點，而且每個主要節點上會共用 4 個連接的磁碟，以及每個資料節點上會共用 16 個連接的磁碟，則您會有 208 個 VM 和 3,232 個磁碟需要管理。

儲存體帳戶將根據它所識別出的每秒 20,000 個交易限制上調節要求，因此，您應該查看儲存體帳戶的資料分割，並使用計算來判斷適當數目的儲存體帳戶以配合此拓撲。假設自由格式的方法支援多種組合，則需要動態計算來判斷適當的資料分割。Azure 資源管理員範本語言目前不提供數學函式，所以您必須在程式碼中執行這些計算，產生唯一的硬式編碼範本以及適當的詳細資料。

在企業 IT 和 SI 案例中，有人必須維護範本，並提供已針對一或多個組織部署之拓撲的支援。這個額外負擔 (每位客戶都有不同的組態和範本) 並不盡理想。

您可以使用這些範本，在客戶的 Azure 訂用帳戶中部署環境，但是企業 IT 團隊和 CSV 通常會將它們部署到他們自己的訂用帳戶，使用計費函式來向客戶收費。在這些情況下，目標是要跨訂用帳戶集區部署適用於多位客戶的容量，並讓部署密集聚集在訂用帳戶中，以便將訂用帳戶的擴展最小化，也就是能夠管理更多訂用帳戶。透過真正的動態部署大小，達到這種類型的密度需要仔細規劃，以及其他針對代表組織之樣版工作的部署。

此外，您無法透過 API 呼叫來建立訂用帳戶，但必須透過入口網站手動執行此動作。隨著訂用帳戶數目增加，任何產生的訂用帳戶擴展都必須人為介入，根本無法自動化。由於部署的大小如此多變，因此您必須手動預先佈建一些訂用帳戶，以確保有訂用帳戶可供使用。

考慮這所有因素，真正的自由格式組態乍看之下比較不具吸引力。

### 已知組態 - T 恤尺寸調整法

在我們的經驗中，與其給予範本來提供總彈性和無數個變化，常見模式是提供選取已知組態的功能 - 實際上，是諸如沙箱、小型、中型和大型等標準 T 恤尺寸。T 恤尺寸的其他範例包括產品供應項目，例如社群版本或企業版本。在其他情況下，這可能是某種技術的工作負載特定組態， 例如，對應減少或沒有 SQL。

許多企業 IT 組織、OSS 廠商和 SI 目前都能在內部部署且虛擬化的環境 (企業) 中或做為「軟體即為服務」(SaaS) 供應項目 (CSV 和 OSV)，使用這種方式來使他們的供應項目可供使用。

這種方法可針對預先為客戶設定好的各種大小提供良好且已知的組態。如果沒有已知組態，客戶就必須自行判斷叢集大小、納入平台資源限制，以及進行數學運算來識別儲存體帳戶所產生的資料分割和其他資源 (因叢集大小和資源限制而導致) 。已知組態讓客戶能夠輕鬆選取正確的 T 恤尺寸，也就是指定的部署。除了為客戶提供更好的經驗，少量的已知組態可讓您更輕鬆地提供支援，並協助您提供較高的密度等級。

著重於 T 恤尺寸的已知組態方法在某個尺寸內可能也會擁有各種節點數目。例如，小型 T 恤尺寸可能介於 3 到 10 個節點之間。T 恤尺寸是設計來最多容納 10 個節點，並讓取用者能夠進行任意形式的選擇 (最多可達已識別出的大小上限)。

以工作負載類型為基礎的 T 恤尺寸在可部署的節點數目方面本質上的形式可能更自由，但是會對節點上的軟體產生工作負載完全不同的節點大小與組態。

以產品供應項目為依據的 T 恤尺寸 (例如社群或企業) 可能會有不同的資源類型和可部署的節點數目上限，通常會受到不同供應項目上的授權考量或功能可用性所影響。

您也可以使用以 JSON 為基礎的範本，利用獨特的變體來配合客戶。處理極端值時，您可以併入開發、支援和成本的適當規劃與考量。

根據客戶範本取用案例、本文件開頭所識別的要求，以及我們所建立的許多範本實際操作經驗，我們找到了一個適合用來進行範本分解的模式。

## 已設定容量和功能範圍的解決方案範本

分解可提供範本開發的模組化方法，以支援重複使用、擴充性、測試和工具設定。本節提供如何將分解方法套用到具有容量或功能範圍的範本詳細資料。

在這種方法中，主要的範本會接收到來自範本取用者的參數值，然後是下游的數種類型範本和指令碼的連結，如下所示。參數、靜態變數和產生的變數可用來提供進出連結範本的值。

![範本參數](./media/best-practices-resource-manager-design-templates/template-parameters.png)

**參數會傳遞到主要的範本，然後傳遞到連結的範本**

以下各節會將焦點放在範本類型以及可分解單一範本的指令碼上，並檢查範本之間用來傳遞狀態資訊的方法。此圖中的每個範本和指令碼類型都會使用範例來說明。如需內容相關範例，請參閱本文件稍後的＜整合在一起：範例實作＞。

### 範本中繼資料

範本中繼資料 (metadata.json 檔案) 包含使用 JSON 說明範本的機碼/值組，讓人類和軟體系統都能讀取該範本。

![範本中繼資料](./media/best-practices-resource-manager-design-templates/template-metadata.png)

**範本中繼資料的說明位於 metadata.json 檔案中**

軟體代理程式可以擷取 metadata.json 檔案，並將資訊和連結發佈到網頁或目錄中的範本。項目包括 *itemDisplayName*、*description*、*summary*、*githubUsername* 及 *dateUpdated*。

以下顯示完整的範例檔案。

    {
        "itemDisplayName": "PostgreSQL 9.3 on Ubuntu VMs",
        "description": "This template creates a PostgreSQL streaming-replication between a master and one or more slave servers each with 2 striped data disks. The database servers are deployed into a private-only subnet with one publicly accessible jumpbox VM in a DMZ subnet with public IP.",
        "summary": "PostgreSQL stream-replication with multiple slave servers and a publicly accessible jumpbox VM",
        "githubUsername": "arsenvlad",
        "dateUpdated": "2015-04-24"
    }

### 主要的範本

主要的範本 (azuredeploy.json 檔案) 是由使用者呼叫，而且是透過它提供一組使用者定義參數的範本。

![主要的範本](./media/best-practices-resource-manager-design-templates/main-template.png)

**主要的範本會接收來自使用者的參數**

此範本的角色會接收來自使用者的參數、使用該資訊填入一組複雜的物件變數，然後使用範本連結執行一組適當的相關範本。

提供的其中一個參數是已知組態類型，因為其標準化的值 (例如，小型、中型或大型)，所以也稱為 T 恤尺寸參數。實際上，您可以多種方式來使用此參數。如需詳細資訊，請參閱本文件稍後的＜已知組態資源範本＞。

無論使用者參數所指定的已知組態為何，都會部署某些資源。這些資源會使用單一共用資源範本來佈建，並與其他範本共用，如此便能先執行共用的資源範本。

不論指定的已知組態為何，都會選擇性地部署某些資源。

### 共用的資源範本

此範本會提供所有已知組態上通用的資源。其中包含不論部署的已知組態範本為何都是必要項目的虛擬網路、可用性設定組和其他資源。

![範本資源](./media/best-practices-resource-manager-design-templates/template-resources.png)

**共用的資源範本**

資源名稱 (例如虛擬網路名稱) 會以主要的範本為根據。您可以視組織需求而定，將它們指定為該範本內的變數，或從使用者處接收它們做為參數。

### 選擇性資源範本

選擇性資源範本包含以參數或變數的值為根據且利用程式設計方式部署的資源。

![選擇性資源](./media/best-practices-resource-manager-design-templates/optional-resources.png)

**選擇性資源範本**

例如，您可以使用選擇性資源範本來設定 Jumpbox，以便從公用網際網路間接存取部署的環境。您會使用參數或變數來識別是否應啟用 Jumpbox，並使用 *concat* 函式來建置範本的目標名稱，例如 *jumpbox_enabled.json*。範本連結會使用產生的變數來安裝 Jumpbox。

您可以從多個位置連結選擇性資源範本：

-	若適用於每個部署，即可從共用的資源範本建立參數導向的連結。
-	適用於選取已知組態時 (例如，安裝於大型部署上)，即可從已知組態範本建立參數導向或變數導向的連結。

指定的資源是否為選擇性，可能不是由範本取用者所驅動，而是由範本提供者所驅動。例如，您可能需要滿足特定的產品需求或產品附加元件 (通常適用於 CSV) 或強制執行原則 (通常適用於 SI 與企業 IT 群組)。在這些情況下，您可以使用變數來判斷是否應該部署資源。

### 已知組態資源範本

在主要的範本中，參數會公開，讓範本取用者能夠指定要部署的期望已知組態。在許多情況下，這個已知組態會使用具有一組固定組態大小 (例如，沙箱、小型、中型和大型) 的 T 恤尺寸方法。

![已知組態資源](./media/best-practices-resource-manager-design-templates/known-config.png)

**已知組態資源範本**

通常會使用 T 恤尺寸方法，但參數可代表任何已知組態的組合。例如，您可以為企業應用程式指定一組環境，例如，開發、測試和產品。或者，您可以針對雲端服務使用它來代表不同的縮放單位、產品版本或產品組態，例如，社群、開發人員或企業。

如同共用的資源範本，變數會從下列任一處傳遞到已知組態範本：

-	使用者 - 也就是傳送到主要範本的參數。
-	組織 - 也就是主要範本中代表內部需求或原則的變數。

### 成員資源範本

在已知組態中，通常會包含一或多個成員節點類型。例如，使用 Hadoop，您會有主要節點和資料節點。如果正在安裝 MongoDB，則會有資料節點和仲裁程式。如果正在部署 DataStax，就必須擁有資料節點，以及已安裝 OpsCenter 的 VM。

![成員資源](./media/best-practices-resource-manager-design-templates/member-resources.png)

**成員資源範本**

每種類型的節點可具有不同大小的 VM、連接的磁碟數目、安裝和設定節點的指令碼、適用於 VM 的連接埠組態、執行個體數目，以及其他詳細資料。因此，每個節點類型都會取得自己的成員資源範本，其中包含部署和設定基礎結構，以及執行指令碼在 VM 內部署和設定軟體的詳細資料。

針對 VM，通常會使用兩種類型的指令碼：廣泛可重複使用和自訂的指令碼。

### 廣泛可重複使用的指令碼

廣泛可重複使用的指令碼可以在多種類型的範本上使用。在這些廣泛可重複使用的指令碼中，有一個較好的範例是在 Linux 上設定 RAID 來共用磁碟，並取得更多的 IOPS 數量。不論 VM 中安裝了哪種軟體，此指令碼都會針對常見案例重複使用經過證實的做法。

![可重複使用的指令碼](./media/best-practices-resource-manager-design-templates/reusable-scripts.png)

**成員資源範本能夠呼叫廣泛可重複使用的指令碼**

### 自訂指令碼

範本通常會呼叫一或多個指令碼，在 VM 內安裝和設定軟體。常見的模式會出現在大型拓撲中，其中部署了一或多個成員類型的多個執行個體。安裝指令碼會針對每個可平行執行的 VM 加以啟動，後面接著要在部署所有 VM (或指定成員類型的所有 VM) 之後呼叫的安裝指令碼。

![自訂指令碼](./media/best-practices-resource-manager-design-templates/custom-scripts.png)

**成員資源範本可基於特定目的呼叫指定碼，例如 VM 組態**

## 已設定功能範圍的解決方案範本範例 - Redis

為了顯示實作可能的運作方式，讓我們來看一個建置範本的實用範例，該範例將以標準的 T 恤尺寸來簡化 Redis 的部署和組態。

針對部署，將會有一組共用資源 (虛擬網路、儲存體帳戶、可用性設定組) 和一個選擇性資源 (Jumpbox)。有多個以 T 恤尺寸 (小型、中型、大型) 來表示的已知組態，但每一個都具有單一節點類型。此外，還有兩個具備特定目的的指令碼 (安裝、組態)。

### 建立範本檔案

您會建立名為 azuredeploy.json 的主要範本。

您會建立名為 shared-resources.json 的共用資源範本

您會建立選擇性資源範本來啟用 Jumpbox 的部署 (名為 jumpbox_enabled.json)

Redis 只會使用單一節點類型，因此您將建立名為 node-resources.json 的單一成員資源範本。

使用 Redis，您會想要安裝每個個別的節點，接著，並且在安裝所有節點之後，會想要設定叢集。您必須有可與下列這兩個指令碼配合的指令碼：redis-cluster-install.sh 和 redis-cluster-setup.sh。

### 連結範本

使用範本連結時，主要的範本會向外連結到共用的資源範本，以建立虛擬網路。

邏輯會新增到主要的範本內，讓範本的取用者能夠指定是否應該部署 Jumpbox。*EnableJumpbox* 參數的 *enabled* 值表示客戶想要部署 Jumpbox。提供此值時，範本會串連 *_enabled* 做為 Jumpbox 功能之基底範本名稱的尾碼。

主要的範本會套用 *large* 參數值做為 T 恤尺寸之基底範本名稱的尾碼，然後在向外連到 *technology_on_os_large.json* 的範本連結中使用該值。

拓撲會類似下圖。

![Redis 範本](./media/best-practices-resource-manager-design-templates/redis-template.png)

**Redis 範本的範本結構**

### 設定狀態

針對叢集中的節點，有兩個步驟可用來設定狀態，這兩個都是透過具有特定目的的指令碼來表示。“redis-cluster-install.sh” 將執行 Redis 的安裝，而 “redis-cluster-setup.sh” 將設定叢集。

### 支援不同大小的部署

在變數內部，T 恤尺寸的範本會針對特定大小 (*large*) 指定每個要部署類型的節點數目。接著，使用資源迴圈來部署該數目的 VM 執行個體，藉由從 *copyIndex()* 附加具有數字序號的節點名稱，為資源提供唯一的名稱。它會針對作用區和暖區的 VM 執行此動作，如同 T 恤名稱範本中所定義

## 分解和已設定端對端解決方案範圍的範本

具有端對端解決方案範圍的解決方案範本會將重點放在提供端對端解決方案。這通常是多個已設定功能範圍的範本以及其他資源、邏輯和狀態的組合。

如下圖中反白顯示的，同樣適用於已設定功能範圍之範本的模型，會針對具有端對端解決方案範圍的範本加以擴充。

共用的資源範本和選擇性資源範本可提供和已設定容量與功能範圍的範本方法一樣的函式，但會針對端對端解決方案設定範圍。

由於已設定端對端解決方案範圍的範本通常也會有 T 恤尺寸，因此，已知組態資源範本會反映解決方案中指定已知組態所需的功能。

已知組態資源範本將連結到一或多個與端對端解決方案相關且已設定功能範圍的解決方案範本，以及端對端解決方案所需的成員資源範本。

當解決方案的 T 恤尺寸可能與已設定功能範圍的個別範本不同時，已知組態資源範本內的變數就能用來針對下游已設定功能範圍的解決方案範本提供適當的值，以部署適當的 T 恤尺寸。

![端對端](./media/best-practices-resource-manager-design-templates/end-to-end.png)

**適用於已設定容量或功能範圍之解決方案範本的模型可針對端對端解決方案範本範圍輕易地進行擴充**

## 準備適用於 Marketplace 的範本

上述方式可輕易地配合企業、SI 和 CSV 想要自行部署範本，或讓客戶自行部署的案例。

另一個所需的案例是透過 Marketplace 來部署範本。這個分解方法也適用於 Marketplace，但會有些微變更。

如先前所述，範本可用來提供不同的部署類型，以便在 Marketplace 中進行銷售。不同的部署類型可能是 T 恤尺寸 (小型、中型、大型)、產品/對象類型 (社群、開發人員、企業) 或功能類型 (基本、高可用性)。

如下所示，您可以輕鬆地利用現有的端對端解決方案或已設定功能範圍的範本，在 Marketplace 中列出不同的已知組態。

主要範本的參數會先加以修改，以移除名為 tshirtSize 的輸入參數。

將不同的部署類型對應到已知組態資源範本時，它們也需要可在共用資源範本中找到的通用資源和組態，而且可能會在選擇性資源範本中使用它們。

如果您想要將範本發佈到 Marketplace，只需建立不同的主要範本複本，將先前可用的 tshirtSize 輸入參數取代為內嵌在範本內的變數。

![Marketplace](./media/best-practices-resource-manager-design-templates/marketplace.png)

**針對 Marketplace 調整已設定解決方案範圍的範本**

## 後續步驟

- 若要查看如何實作本主題所提供之設計原理的內容相關範例，請參閱[實作範本的最佳做法內容範例](best-practices-resource-manager-examples.md)。
- 如需如何在 Azure 資源管理員中處理安全性的建議，請參閱 [Azure 資源管理員的安全性考量](best-practices-resource-manager-security.md)
- 若要了解進出範本的共用狀態，請參閱 [Azure 資源管理員範本中的共用狀態](best-practices-resource-manager-state.md)。

<!---HONumber=July15_HO4-->