<properties
	pageTitle="能源需求預測的 Cortana Analytics 解決方案範本教戰守則 | Microsoft Azure"
	description="使用 Microsoft Cortana Analytics 的解決方案範本，協助預測能源公共事業公司的需求。"
	services="cortana-analytics"
	documentationCenter=""
	authors="ireiter"
	manager="ireiter"
	editor="cgronlun"/>

<tags
	ms.service="cortana-analytics"
	ms.workload="data-services"
	ms.tgt_pltfrm="na"
	ms.devlang="na"
	ms.topic="article"
	ms.date="01/24/2016"
	ms.author="ireiter;yijichen;garye"/>

# 能源需求預測的 Cortana Analytics 解決方案範本教戰守則  

## 執行摘要  

過去幾年來，物聯網 (IoT)、替代能源和巨量資料已共同在公共事業和能源領域中創造龐大的機會。在此同時，公共事業和整個能源工業看到用電量已失控，消費者急需更有效地控制能源用量。因此，公共事業和智慧電網公司本身極需改革與創新。此外，許多電力和公共電網已經過時，維護和管理所費不貲。去年，本小組在能源領域內從事許多研究。在這些研究中，我們經常發現公共事業或 ISV (獨立軟體廠商) 一直在探索如何預測未來的能源需求。這些預測在其目前和未來的事業中扮演著重要角色，已成為不同使用案例的基礎。其中包括短期與長期的電力負載預測、交易、負載平衡、電網最佳化等。為了產生準確且可靠的預測，巨量資料和進階分析 (AA) 方法是關鍵因素，例如機器學習服務 (ML)。

在本教戰守則中，我們結合商務和分析指導方針，以成功開發及部署能源需求預測解決方案。這些建議的指導方針可協助公共事業、資料科學家和資料工程師建立全面運作、以雲端為基礎的需求預測解決方案。對於剛踏入巨量資料和進階分析領域的公司，這種解決方案就是長期智慧電源策略的菩提種子。

>[AZURE.TIP] 若要下載此範本的架構概觀圖表，請參閱[能源需求預測的 Cortana Analytics 解決方案範本架構](cortana-analytics-architecture-demand-forecasting-energy.md)。

## 概觀  

本文件涵蓋使用 Cortana Analytics (尤其是 Azure Machine Learning (AML)) 來實作與部署能源預測解決方案的商務、資料和技術層面。文件包含三個主要部分 ︰

1. 了解商務  
2. 了解資料  
3. 技術實作

「了解商務」部分概述在進行投資決策之前需要了解及考慮的商務層面。其中說明如何評估眼前的商務問題，以確保預測性分析和機器學習服務確實有效且可行。本文件進一步說明機器學習服務的基本概念及如何用來解決能源預測問題。其中概述使用案例的先決條件和檢定準則。另外也提供一些範例使用案例和商務案例。

資料是任何機器學習服務解決方案的主要成分。本文件的「了解資料」部分涵蓋一些重要的資料層面。其中概述能源預測所需的資料種類、資料品質需求，以及通常存在的資料來源。我們也會說明如何使用原始資料，以備妥實際主導模型化部分的資料特徵。

本文件的第三個部分涵蓋解決方案的「技術實作」層面。特徵工程設計和模型化是資料科學程序的核心，因此會更詳細討論。其中涵蓋 Web 服務的概念，在預測性分析解決方案的雲端部署方面，這些是很重要的機制。我們也會概述端對端運作解決方案的一般架構。

此外，本文件還包含參考資料，幫助您進一步了解這個領域和技術。

請務必注意，本文件不涵蓋深奧的資料科學程序，及其數學和技術層面。您可以在 [Azure ML 文件](http://azure.microsoft.com/services/machine-learning/)和[部落格](http://blogs.microsoft.com/blog/tag/azure-machine-learning/)找到這些詳細資料。

### 目標對象   
本文件以商業和技術人員為目標對象，幫助他們認識和了解機器學習服務解決方案，及其在能源預測領域內的具體運用情形。

本文件也有益於資料科學家深入了解主導能源預測解決方案部署的高階程序。就這方面而言，本文件也能為閱讀更詳細和進階的資料打下扎實的基礎和發出點。

### 產業趨勢  
過去幾年來，IoT、替代能源和巨量資料已共同在公共事業和能源領域中創造龐大的機會。在此同時，公共事業和整個能源工業看到用電量已失控，消費者急需更有效地控制能源用量。

許多公共事業和智慧能源公司都在研發[智慧電網](https://en.wikipedia.org/wiki/Smart_grid)，利用電網所產生的資料來部署使用一些案例。許多使用案例脫離不了發電的固有特性 ︰無法累積也無法貯藏。因此，生產出來就必須用掉，別無選擇。公共事業想要變得更有效率必須預測的用電量，理由很簡單，因為如此才更能平衡供需，以避免浪費能源、減少溫室氣體排放及控制成本。

提到成本時，還有另一個重點，就是價格。公共事業之間電力交易的新業務導致更需要預測未來的電力需求和價格。這有助於公司決定他們的產量。

我們提到「智慧」這個詞時，實際是指可學習並進行預測的電網。它可以預測季節性的用電量變化，以及預知暫時性超載情況並自動調整。藉由從遠端調節用電量 (借助這些智慧型電表)，就可以處理地區性超載情況。電網會先預測再行動，隨著時間而變得越來越聰明。

本文件的其餘部分著重於一系列特定的使用案例，涵蓋預測未來、短期和長期的能源需求。數個月來我們一直努力於這些領域，已獲得一些知識和技能，能夠產生工業級的結果。不久的未來，本文件也會涵蓋其他使用案例。

## 了解商務

### 商務目標
「能源示範」目的在於示範可在極短時間內部署的一般預測性分析和機器學習服務解決方案。具體來說，我們目前的焦點是推動能源需求預測解決方案，以快速實現並運用其商業價值。本教戰守則中的資訊可協助客戶達成下列目標︰
-   加速機器學習服務解決方案的價值實現
-   能夠根據其商務需求，將試驗性使用案例擴展到其他使用案例或更廣的範圍
-   快速獲得 Cortana Analytics Suite 產品知識

本教戰守則謹記這些目標，希望提供商務和技術知識來協助達成這些目標。

### 電力負載和需求預測
在能源產業內，需求預測在許多方面可協助解決危急的商業問題。事實上，需求預測可視為產業中許多核心使用案例的基礎。一般而言，我們會考慮兩種能源需求預測︰短期和長期。各有不同的用途並採用不同的方法。兩者的主要差異在於預測範圍，也就是可預測的未來時間範圍。

#### 短期負載預測
在能源需求方面，短期負載預測 (STLF) 定義為對電網各部分 (或整個電網) 預測不久將來的總體負載。在此，短期定義為 1 小時到 24 小時範圍內的時間範圍。在某些情況下，範圍也可能長達 48 小時。因此，STLF 在電網的運作使用案例中很常見。以下是 STLF 導向的使用案例的一些例子：
-   供需平衡
-   電力交易支援
-   造市 (訂定電價)
-   電網運作最佳化
-   [需求回應](https://en.wikipedia.org/wiki/Demand_response)
-   尖峰需求預測
-   需求面管理
-   負載平衡和預防超載
-   長期負載預測
-   故障和異常偵測
-   尖峰限電/調節 

STLF 模型大多根據最近 (昨天或上週) 的用電量資料，並以預測溫度作為重要的預測因子。現在，取得未來一小時甚至 24 小時的準確溫度預測並不困難。這些模型較不易受到季節性模式或長期用電量趨勢所影響。

SLTF 解決方案也可能引起大量的預測呼叫 (服務要求)，因為每小時就要引用一次，在某些情況下甚至更頻繁。也常見到機房中每個變電站或變壓器都是獨立模型，因此預測要求量甚至更高。

#### 長期負載預測
長期負載預測 (LTLF) 的目標是預測時間範圍從 1 週到數個月的電力需求 (在某些情況下可能是許多年)。此時間範圍最適用於規劃和投資使用案例。

在長期情況下，需要有涵蓋多年 (至少 3 年) 的高品質資料。這些模型通常會從歷史資料中萃取出季節性模式，並利用外部預測因子，例如天氣和氣候模式。

必須澄清，預測時間越長，預測越不準確。因此，除了實際預測，還必須產生一些信賴區間，以利用於規劃過程中考慮到可能的變異。

由於 LTLF 的用電量案例大多用於規劃，預測量必然很低 (相較於 STLF)。我們通常會看到這些預測內嵌至視覺化工具中，例如 Excel 或 PowerBI，並由使用者手動引用。

### 短期與長期預測
下表比較 STLF 和 LTLF 的最重要屬性︰

|屬性|短期負載預測|長期負載預測|
|---|---|---|
|預測時間範圍|從 1 小時到 48 小時|從 1 週到 6 個月以上|
|資料細微度|每小時|每小時或每日|
|一般使用案例|<ul><li>供需平衡</li><li>尖峰時段預測</li><li>要求回應</li></ul>|<ul><li>長期規劃</li><li>電網資產規劃</li><li>資源規劃</li></ul>|
|一般預測因子|<ul><li>日或週</li><li>當天時段</li><li>每小時溫度</li></ul>|<ul><li>年度月份</li><li>月份日期</li><li>長期溫度和氣候</li></ul>|
|歷史資料範圍|二至三年份的資料|五至 10 年份的資料|
|一般精確度|95% 或更高的 MAPE*|75% 或更高的 MAPE*|
|預測頻率|每小時或每 24 小時產生一次|每週、每月或每季產生一次|
*[MAPE](https://en.wikipedia.org/wiki/Mean_absolute_percentage_error) – 百分比錯誤平均數

從這個表格可以看出，區別短期和長期預測案例相當重要，因為這些各代表不同的商務需求，可能會有不同的部署和用電模式。

### 範例使用案例 1：Esmart Systems – 超載最佳化
[智慧電網](https://en.wikipedia.org/wiki/Smart_grid)是一個重要角色是隨著不斷變化的用電模式，而動態和持續地最佳化並調整。用電量可能受到短期變化所影響，主要是溫度變動所造成 (例如，空調或暖氣的用電增加)。同時，用電量也會受到長期趨勢所影響。其中包括季節性效應、國定假日、長期用電量成長，甚至是經濟因素，例如消費者指數、石油價格和 GDP。

在此使用案例中，[eSmart](http://www.esmartsystems.com/) 想要部署以雲端為基礎的解決方案，以預測電網的任何給定變電站發生超載情況的傾向。特別是的，eSmart 希望找出下一個小時可能超載的變電站，以立即採取動作來避免或解決這種情況。

為了精確和快速預測，必須實作三種預測模型︰
-   可預測每個變電站未來幾週或幾個月用電量的長期模型
-   可預測給定變電站在下一個小時發生超載情況的短期模型
-   在多個案例上提供未來溫度預測的溫度模型

長期模型的目標是依下一週或下個月的超載傾向將變電站排名 (根據其電力輸送能力)。這樣可建立一份變電站初步名單，作為短期預測的輸入。因為溫度是長期模型的重要預測因子，需要不斷產生多重案例的溫度預測，並輸入到長期模型中。接著叫用短期預測，以預測下一個小時可能超載的變電站。

每個變電站個別地部署短期和長期模型。因此，實際執行這些模型需要大量的協調流程。為了在短期內獲得更高的預測精確度，有更細微的模型專用於一天的每個小時。所有這些模型每個小時都執行，並在幾分鐘內執行完畢，以便有充裕的時間來回應，並視需要採取預防動作。這組模型定期以最新資料重新訓練，隨時保持在最新狀態。

[這裡](https://customers.microsoft.com/Pages/CustomerStory.aspx?recid=18945)提供此使用案例的詳細資訊。

#### 使用案例檢定準則 – 必要條件
Cortana Analytics 的真正威力在於有強大的能力部署及調整以機器學習服務為中心的解決方案。目的是支援數以千計同時執行的預測。它可以自動調整規模以符合不斷變化的用電模式。因此，解決方案的重點是精確度和運算效能。例如，公共事業公司的興趣是為下一個小時及一天中每個小時產生精確的能源需求預測。相反地，我們較沒興趣回答為何預測出如此需求的這種問題 (這是由模型本身來處理)。

因此，必須了解，並非所有使用案例和商務問題都能利用機器學習服務來有效解決。

只要符合下列條件，Cortana Analytics 和機器學習服務可以很有效地解決特定的商務問題︰
-   眼前的商務問題在本質上有預測性。例如，一家公共事業公司想要預測給定變電站下一個小時內的電源負載，這就是預測性使用案例。相反地，分析和排名歷史需求的驅動因素在本質上是描述性，因此較不適用。
-   一旦獲得預測，就能採取明確的動作途徑。例如，預測變電站下一個小時超載可以觸發積極的行動，降低該變電站的相關負載，因而避免可能發生的超載。
-   此使用案例代表典型的問題，只要解決它，就能輕鬆解決其他類似的使用案例。
-   客戶可以設定量化和質化目標，以示範成功的解決方案實作。比方說，必要的精確度臨界值 (例如，最高容許 5% 的錯誤)，或在預測變電站超載時，精確度 (真肯定率) 和回溯 (真肯定的程度) 應超過指定的臨界值，都是能源需求預測的良好量化目標。這些目標應該衍生自客戶的商務目標。
-   關於公司的商務流程，有一個明確的整合案例。比方說，變電站負載預測可以整合到電網控制中心，以利於進行超載預防活動。
-   客戶已準備使用品質足夠的資料來支援使用案例 (詳情請參閱本教戰守則的下一節「資料品質」)。
-   客戶接受以雲端為中心的資料架構或以雲端為基礎的機器學習服務，包括 Azure ML 和其他 Cortana Analytics Suite 元件。
-   客戶願意建立**端對端資料流程**，以利於持續將資料傳入雲端，也願意**實施**解決方案。
-   客戶已準備提供資源來主動參與初始試驗實作過程，以便於成功完成時，就能將解決方案的知識和擁有權移轉給客戶。
-   客戶資源應該為熟練的資料專業人員，最好是資料科學家。

根據上述準則來檢定使用案例，將可大幅提高使用案例的成功率，並為實作未來的使用案例打下良好基礎。

### 以雲端為基礎的解決方案
Cortana Analytics Suite 是位於雲端的整合式環境。在雲端環境中部署進階的分析解決方案，將可以為企業帶來顯著的效益，同時也代表仍在使用內部部署 IT 解決方案的公司將出現巨大的轉變。在能源產業內，明顯看出營運逐漸轉向雲端的趨勢。這種趨勢與上述產業趨勢中的智慧電網發展同步並進。由於本教戰守則著重於能源領域中以雲端為基礎的解決方案，因此必須說明部署以雲端為基礎的解決方案帶來的優點和其他考量。

以雲端為基礎的解決方案帶來的最大優點，可能就在於成本。由於解決方案使用雲端部署的元件，因此不需要前期成本或相關的 COGS (銷貨成本) 元件成本。這表示不需要投資硬體、軟體和 IT 維護，因而大幅降低商業風險。

另一個重要優點是以雲端為基礎的解決方案採用隨用隨付成本結構。做為計算或儲存用途的以雲端為基礎的伺服器，可以視需要而部署及調整。這代表以雲端為基礎的解決方案帶來的成本效益優點。

最後，不需要投資 IT 維護或未來的基礎結構開發，因為以雲端為基礎的供應項目中已一應俱全。就這點而言，Cortana Analytics Suite 包含最優秀的服務，而其發展路線一直在進化中。新的特性、元件和功能持續地推出和演進。

對於剛開始轉換到雲端的公司，強烈建議實作雲端移轉藍圖，採取漸進方式。對於能源領域中的公共事業或公司，我們相信本教戰守則所討論的使用案例，就代表在雲端中試驗預測性分析解決方案的絕佳機會。

#### 商務案例理由考量
在許多情況下，客戶可能想要對給定的使用案例提出一個商業理由，表明以雲端為基礎的解決方案和機器學習服務是重要的元件。不同於內部部署解決方案，在以雲端為基礎的解決方案中，前期成本的成分極少，大部分的成本要素都與實際用量有關。說到部署預測上 Cortana Analytics 解決方案的能源，多個服務可以與單一的一般成本結構整合。比方說，資料庫 (例如 SQL Azure) 可以用來儲存原始資料，然後在實際預測時，使用 Azure ML 來裝載預測服務。在此範例中，成本結構可能包含儲存體和交易式元件。

另一方面，應該要正確了解從事能源需求預測 (短期或長期) 的商業價值。事實上，必須了解每個預測作業的商業價值。比方說，精確預測接下來 24 小時內的電力負載，可以避免生產過剩或電網超載，還能從每日節省的資金來量化這方面的資訊。

需求預測解決方案財務優點的基本計算公式為︰![需求預測解決方案財務優點的基本計算公式](media/cortana-analytics-playbook-demand-forecasting-energy/financial-benefit-formula.png)

由於 Cortana Analytics Suite 提供隨用隨付價格模式，所以不需要將固定成本項帶入這個公式中。每日、每月或每年都可以計算此公式。

[這裡](http://azure.microsoft.com/pricing/details/machine-learning/)提供 Cortana Analytics Suite 和 Azure ML 目前的價格方案。

### 解決方法開發程序
能源需求預測解決方案的開發週期通常需要 4 個階段，在所有階段中，我們都採用 Cortana Analytics Suite 內以雲端為基礎的技術和服務。

下圖提供相關說明：

![智慧電網週期](media/cortana-analytics-playbook-demand-forecasting-energy/smart-grid-cycle.png)

下一段說明這 4 個步驟的程序︰

1.  資料收集 – 任何以進階分析為基礎的解決方案都仰賴資料 (請參閱「了解資料」)。具體來說，在提及預測性分析和預測時，我們需要持續、動態的資料流。就能源需求預測而言，這項資料可能直接來自智慧型電表，或已在內部部署資料庫上彙總。我們也依賴其他外部資料來源，例如天氣和溫度。這個持續的資料流必須協調、排程及儲存。[Azure Data Factory](http://azure.microsoft.com/services/data-factory/) (ADF) 是我們完成這項工作的主力工具。
2.  模型化 – 為了獲得精確又可靠的能源預測，我們必須開發 (訓練) 並維護一個優秀的模型，以利用歷史資料，並從資料中擷取有意義和可預測的模式。隨著不斷開發出先進的演算法，機器學習服務 (ML) 領域一直在快速成長。Azure ML Studio 提供絕佳的使用者體驗，有助於在完整的工作流程中利用最先進的 ML 演算法。該工作流程如直覺式流程圖所示，包含準備資料、萃取特徵、模型化和評估模型。使用者可以取用此環境中數以百計的各種不同模型。此階段的結束時，資料科學家會獲得一個已完整評估且可部署的工作模型。

	下圖是一般工作流程的說明︰

	![模型化工作流程](media/cortana-analytics-playbook-demand-forecasting-energy/modeling-workflow.png)

3.  部署 – 獲得工作模型後，下一步就是部署。在此，模型轉換為 Web 服務並公開 RESTful API，供各種用電用戶端透過網際網路同時叫用。Azure ML 提供簡單的方法，直接從 Azure ML Studio 中按一下按鈕，就能部署模型。整個部署程序都是自動完成。這個解決方案可以自動調整規模以符合所需的用電量。

4.  用電量 – 在這個階段，我們實際利用預測模型來產生預測。用電量可由使用者應用程式 (例如，儀表板) 或直接從作業系統來控管，例如供需平衡系統或電網最佳化解決方案。單一模型可以控管多個使用案例。

## 了解資料
討論過能源需求預測解決方案的商務考量之後 (請參閱「了解商務」)，現在可以開始討論資料部分。任何預測性分析解決方案都仰賴可靠的資料。在能源需求預測方面，我們依賴不同細微程度的用電量歷史資料。該歷史資料就成為原始資料。經過仔細分析，資料科學家將找出預測因子 (也稱為特徵)，然後輸入模型中，最後產生所需的預測。

在本節的其餘部分，我們將說明各種步驟和考量，讓您了解資料及如何轉換成實用的格式。

### 模型開發週期
需要仔細準備和規劃才能產生良好的預測模型。將模型化程序分解成多個步驟，且一次專注於一個步驟，如此即可大幅改善整個程序的結果。

下圖說明如何將模型化程序分解成多個步驟︰

![模型開發週期](media/cortana-analytics-playbook-demand-forecasting-energy/model-development-cycle.png)

從上圖可知，週期包含六個步驟：
-   問題編寫
-   資料擷取和資料探索
-   資料準備和特徵設計
-   模型化
-   模型評估
-   開發

在本節的其餘部分，我們將說明個別的步驟及每個步驟需要考量的項目。

### 問題編寫
問題編寫可視為在實作任何預測性分析解決方案之前，必須執行的最重要步驟。在此我們會轉換商務問題，並將它分解成利用資料和模型化技術就可解決的特定要素。最好將問題編寫成一組我們想要回答的問題。以下是能源需求預測範圍內可能適用的一些問題︰
-   個別變電站在下一個小時或次日預期的負載是什麼？
-   我的電網在一天之中何時會遇到尖峰需求？
-   我們電網有多少能耐承受預期的尖峰負載？
-   發電廠在一天的每個小時內產生多少電力？

擬定這些問題可讓我們專注於取得正確的資料，並充分配合眼前的商務問題來實作解決方案。此外，我們可以再設定一些重要的計量，讓我們評估模型的效能。比方說，預測應該有多高的準確度及企業仍可接受多大的錯誤範圍？

### 資料來源
現代智慧電網會從電網的各種組件和元件收集資料。此資料代表電網運作和利用的各個層面。在能源需求預測的範圍內，我們的討論僅限於可反映實際需求消耗的資料來源。能源消耗量的重要來源之一是智慧型電表。世界各地的公共事業正快速地為消費者部署智慧型電表。智慧型電表會記錄實際的用電量，並不斷地將此資料轉送給公共事業公司。資料是以固定時間間隔收集並傳回，範圍從每 5 分鐘到 1 小時。更先進的智慧型電表可以設計成從遠端控制，並平衡住家內的實際用電量。智慧型電表資料相當可靠，而且包含時間戳記。因此成為需求預測的重要元素。電表資料可以電網拓撲內的各個層級上彙總 (加總)︰變壓器、變電站、區域等。然後，我們可以挑選彙總層級來建置預測模型。比方說，如果公共事業公司想要預測每一個電網變電站的未來負載，則可以針對每個變電站來彙總所有電表的資料，再做為預測模型的輸入。我們將智慧型電表稱為內部資料來源。

可靠的能源需求預測也依賴其他外部資料來源。影響用電量的一個重要因素是天氣，更準確地說是溫度。歷史資料顯示室外溫度和用電量之間有很大的關聯性。在酷暑季節，消費者會開冷氣機，而冬季時會開啟暖氣系統。因此，關鍵在於電網地點要有可靠的歷史溫度來源。此外，我們也依賴精確預測的溫度當作用電量的預測因子。

其他外部資料來源也有助於建立能源需求預測模型。其中可能包括長期氣候變化、經濟指標 (例如 GDP) 等。本文中不討論其他這些資料來源。

### 資料結構
決定所需的資料來源之後，我們需要確定已收集的原始資料包含正確的資料特徵。若要建立可靠的需求預測模型，我們需要確定收集的資料包含有助於預測未來需求的資料元素。以下是關於原始資料的資料結構 (結構描述) 的一些基本條件。

原始資料是由資料列和資料行所組成。每個度量單位以單一資料列表示。每個資料列包含多個資料行 (也稱為特徵或欄位)。

1.  時間戳記 – 時間戳記欄位代表記錄度量時的實際時間。它應該符合其中一種常見的日期/時間格式。應該同時包含日期和時間部分。在大部分情況下，除非達到「秒」的細微層級，否則不需要記錄時間。必須指定記錄資料的時區。
2.  電表識別碼 -此欄位識別電表或測量裝置。它是分類變數，可以是數字和字元的組合。
3.  用電量值 – 這是在指定日期/時間的實際用電量。用電量可以透過 kWh (千瓦時) 或任何其他慣用單位來測量。請務必注意，在所有資料測量中，測量單位必須保持一致。在某些情況下，可能分成 3 個電源階段來供應用電量。在此情況下，我們需要收集所有獨立的用電量階段。
4.  溫度 – 通常會從獨立的來源收集溫度。不過，它應該與用電量資料相容。它應該包含如上所述的時間戳記，因而能夠與實際用電量資料保持同步。溫度值都可以指定為攝氏或華氏度數，但在所有測量中應該保持一致。
5.  位置 – 位置欄位通常與收集溫度資料的位置相關聯。它可以用郵遞區號或經緯度 (lat/long) 格式表示。

下表顯示正確用電量和溫度資料格式的範例︰

|日期|時間|計量識別碼|第 1 階段|第 2 階段|第 3 階段|
|--------|--------|------------|-----------|-----------|-----------|
|7/1/2015|10:00:00|ABC1234 |7\.0 |2\.1 |5\.3 |
|7/1/2015|10:00:01|ABC1234 |7\.1 |2\.2 |4\.3 |
|7/1/2015|10:00:02|ABC1234 |6\.0 |2\.1 |4\.0 |

|日期|時間|位置|溫度|
|--------|--------|-------------|---------------|
|7/1/2015|10:00:00|11242 |24\.4 |
|7/1/2015|10:00:01|11242 |24\.4 |
|7/1/2015|10:00:02|11242 |24\.5 |

從上面可以看出，這個範例包含與 3 電源階段相關聯的 3 個不同用電量值。另外，請注意日期和時間欄位分隔，但也可以結合成單一資料行。在此案例中，位置資料行以 5 位數郵遞區號格式表示，溫度以攝氏度數格式表示。

### 資料格式
Cortana Analytics Suite 支援最常見的資料格式，例如 CSV、TSV、JSON 等。在專案的整個生命週期，資料格式必須保持一致。

### 資料擷取
由於能源需求預測是持續且經常預測，我們必須確保有一個穩固且可靠的資料擷取程序不斷地傳送原始資料。擷取程序必須保證預測程序在需要時一定可以取得原始資料。這表示資料擷取頻率應該高於預測頻率。

例如︰如果需求預測解決方案會在每天上午 8:00 產生新的預測，則我們需要確保在此之前已完全擷取過去 24 小時內已收集的所有資料，甚至包括過去一小時的資料。

為達成此目的，Cortana Analytics Suite 提供各種方法來支援可靠的資料擷取程序。這將在本文件的「部署」一節進一步討論。

### 資料品質
為了執行可靠且正確的需求預測，所需的原始資料來源必須符合一些基本的資料品質準則。雖然進階統計方法可以用來彌補一些可能的資料品質問題，但在擷取新的資料時，我們仍然需要確保跨越某些基本的資料品質門檻。以下是關於原始資料品質的一些考量︰
-   遺漏值 – 這是指未收集到特定度量的情況。在此，基本要求是在任何指定的期間，遺漏值比率都不應該超過 10%。如果遺漏單一值，應該以預先定義的值 (例如：'9999') 表示，而不是可能為有效度量的 '0'。
-   測量精確度 – 應該正確記錄用電量或溫度的實際值。不正確的測量會產生不正確的預測。一般而言，相對於真值，測量誤差應該低於 1%。
-   測量時間 – 相對於實際測量的真正時間，收集資料的實際時間戳記不能偏離超過 10 秒。
-   同步處理 – 使用多個資料來源時 (例如，用電量和溫度)，必須確保它們之間沒有時間同步化的問題。這表示從任何兩個獨立的資料來源收集的時間戳記之間，時差不應超過 10 秒以上。
-   延遲 - 如上所述，在「資料擷取」中，我們依賴可靠的資料流和擷取程序。為了做好控制，必須確保我們控制資料延遲。這指定為從進行實際測量的時間，到已載入至 Cortana Analytics Suite 儲存體且可供使用的時間，兩者之間的時差。對於短期負載預測，總延遲時間不應該超過 30 分鐘。對於長期負載預測，總延遲時間不應該超過 1 天。

### 資料準備和特徵設計
擷取原始資料 (請參閱「資料擷取」) 並安全地儲存後，就可以開始處理。基本上，資料準備階段是取得原始資料並轉換 (變換、重塑) 成適用於模型化階段的格式。其中包括簡單的作業，例如直接使用原始資料行及其實際的測量值、標準化值，還有更複雜的作業，例如[時間延遲](https://en.wikipedia.org/wiki/Lag_operator)等。新建立的資料行稱為資料特徵，而產生這些特徵的程序就稱為特徵設計。此程序結束時，我們會獲得一組從原始資料導出的新資料集，可用於模型化。此外，資料準備階段還必須處理並補償遺漏值 (請參閱「資料品質」)。在某些情況下，我們也需要將資料正規化，以確保所有的值都以相同的級別表示。

在本節，我們列出能源需求預測模型包含的一些常見的資料特徵。

時間導向特徵︰這些特徵衍生自日期/時間戳記資料。這些在擷取後會轉換成類別特徵，例如︰
-   當天時間 – 這是一天中的時段，接受的值從 0 到 23
-   星期 – 這代表星期幾，接受的值從 1 (星期日) 到 7 (星期六)
-   月份日期 – 這代表實際的日期，接受的值從 1 到 31
-   年度月份 – 這代表月份，接受的值從 1 (一月) 到 12 (十二月)
-   週末 – 這是二進位值特徵，接受的值為 0 (工作日) 或 1 (週末)
-   假日 – 這是二進位值特徵，接受的值為 0 (平日) 或 1 (假日)
-   傅立葉項 – 傅立葉項是衍生自時間戳記的權數，用來擷取資料中的季節性 (週期)。因為資料中可能有多個季節，我們可能需要多個傅立葉項。例如，需求值可能有每年、每週和每日季節/週期，所以需要 3 個傅立葉項。

獨立測量特徵︰獨立特徵包括我們想要在模型中作為預測因子的所有資料元素。在此我們排除需要預測的相依特徵。
-   延隔特徵 – 這些是實際需求的時間偏移值。比方說，相對於目前的時間戳記，延隔 1 的特徵保留前一個小時的需求值 (假設是每小時資料)。同樣地，我們可以新增延隔時間 2、延隔 3...等等。實際使用的延隔時間組合是在模型化階段經由評估模型結果而決定。
-   長期趨勢 – 此特徵代表年份之間需求的線性成長。

相依特徵︰相依特徵是模型要預測的資料行。使用[監督式機器學習服務](https://en.wikipedia.org/wiki/Supervised_learning)時，我們必須先使用相依特徵 (也稱為標籤) 來訓練模型。這可讓模型從相依特徵相關聯的資料中學習模式。在能源需求預測中，我們通常想要預測實際需求，因此會將它當作相依特徵。

處理遺漏值︰在資料準備階段，我們需要決定最佳策略來處理遺漏值。這通常是利用各種統計來處理 [資料插補方法] (https://en.wikipedia.org/wiki/Imputation_(statistics))。以能源需求預測而言，我們通常從先前可用的資料點利用移動平均來推算遺漏值。

資料正規化︰資料正規化是另一種轉換，用於將所有數值資料 (例如需求預測) 變成類似的級別。這通常有助於改善模型的正確性和精確度。在作法上我們通常會依資料範圍來分割實際值。這會將原始值按比例縮小到較小的範圍，通常介於 -1 和 1 之間。

## 模型化
模型化階段會將資料轉換成模型。此程序的核心是進階的演算法，負責掃描歷史資料 (訓練資料)、擷取模式及建立模型。稍後，該模型可用來預測未用來建立模型的新資料。

獲得可靠的工作模型後，我們就可以用它來評比在結構上包含所需特徵 (X) 的新資料。評分程序將使用持續性模型 (來自訓練階段的物件)，並預測由 Ŷ 所表示的目標變數。

### 需求預測模型化技巧
在需求預測方面，我們會使用依時間排序的歷史資料。我們通常將包含時間維度的資料稱為[時間序列](https://en.wikipedia.org/wiki/Time_series)。時間序列模型化的目標是尋找時間相關的趨勢、季節性、自相關 (經過一段時間的相互關聯)，並將這些編寫成模型。

在最近幾年，已開發出進階演算法來配合時間序列預測，並改善預測精確度。在此我們簡短討論其中一部分。

> [AZURE.NOTE] 本節並不做為機器學習服務和預測的概觀，只是簡單審視需求預測常用的模型化技術。如需時間序列預測相關的詳細資訊和教學資料，強烈建議您閱讀線上書籍 [Forecasting: principles and practice](https://www.otexts.org/book/fpp)。

#### [**MA (移動平均)**](https://www.otexts.org/fpp/6/2)
移動平均是時間序列預測的第一代分析技巧之一，目前仍是最常用的其中一項技巧。它也是更進階預測技巧的基礎。使用移動平均時，我們會將 K 個最近資料點算出平均值，以預測下一個資料點，其中 K 表示移動平均的順序。

移動平均技巧具有將預測平滑化的效果，因此可能無法處理資料中的劇烈波動性。

#### [**ETS (指數平滑法)**](https://www.otexts.org/fpp/7/5)
指數平滑法 (ETS) 是一系列的各種方法，使用最近資料點的加權平均來預測下一個資料點。在概念上是將較高權數指派給較新的值，而對於較舊的測量值，就逐漸降低此權數。這一系列有許多不同的方法，其中包括處理資料中的季節性，例如 [Holt-Winters 季節性方法](https://www.otexts.org/fpp/7/5)。

其中某些方法也會納入資料的季節性。

#### [**ARIMA (自迴歸整合移動平均)**](https://www.otexts.org/fpp/8)
自迴歸整合移動平均 (ARIMA) 是常用於時間序列預測的另一系列的方法。實際上是結合自迴歸方法與移動平均。自迴歸方法使用迴歸模型時會取得先前的時間序列值來計算下一個日期點。ARIMA 方法也運用差異性方法，包括計算資料點之間的差異，以及使用它們而不是原始的測量值。最後，ARIMA 也使用上面所討論的移動平均技巧。以各種方式將所有這些方法組合起來，就構成 ARIMA 方法系列。

ETS 和 ARIMA 現在廣泛用於能源需求預測和其他許多的預測問題。在許多情況下，這些結合起來可提供非常精確的結果。

一般多元迴歸 迴歸模型可能是機器學習服務和統計學領域中最重要的模型化方法。在時間序列方面，我們使用迴歸來預測未來值 (例如，需求的)。在迴歸中，我們取得預測值的線性組合，並在訓練過程中學習這些預測值的加權 (也稱為係數)。目標是產生迴歸線來預測我們的預測值。當目標變數為數值，就適合採用迴歸方法，因此也適用於時間序列預測。有各種不同的迴歸方法，包括非常簡單的迴歸模型，例如[線性迴歸](https://en.wikipedia.org/wiki/Linear_regression)，還有更進階的迴歸方法，例如決策樹、[隨機樹系](https://en.wikipedia.org/wiki/Random_forest)、[類神經網路](https://en.wikipedia.org/wiki/Artificial_neural_network)和推進式決策樹。

將能源需求預測當作迴歸問題來建構，讓我們在選取資料特徵時很有彈性，這些特徵可能結合自實際的需求時間序列資料和外部因素 (例如溫度)。本教戰守則的「特徵設計」(請參閱「資料準備和特徵設計」) 一節討論所選特徵的詳細資訊。

根據我們在實作和部署能源需求預測試驗的經驗，我們發現 Azure ML 中可用的進階迴歸模型可產生最佳結果，因此我們採用它們。

## 模型評估
模型評估在「模型開發週期」內扮演重要的角色。在這個步驟中，我們以現實生活中的資料來探討驗證模型及其表現。在模型化步驟期間，我們使用一部分可用的資料來訓練模型。在評估階段，我們利用剩餘的資料來測試模型。實際上，這表示我們在模型中輸入的新資料已重新編排，且包含與訓練資料集相同的特徵。不過，在驗證過程中，我們使用模型來預測目標變數，而不是提供可用的目標變數。我們通常稱此程序稱為模型評分。然後，我們會使用真實目標值，並與預測值做比較。在此，目標是測量並最小化預測誤差，也就是預測值與真值之間的差異。量化錯誤度量是關鍵，因為我們想要微調模型，並驗證是否確實減少錯誤。微調模型可以透過修改控制學習程序的模型參數，也可以新增或移除資料特徵 (稱為[參數掃掠](https://channel9.msdn.com/Blogs/Windows-Azure/Data-Science-Series-Building-an-Optimal-Model-With-Parameter-Sweep))。實際上，這表示我們可能需要在特徵設計、模型化和模型評估階段之間反覆許多次，直到能夠將錯誤減少到所需的程度為止。

必須強調，預測誤差永遠不會是零，因為從來沒有任何模型能夠完美預測所有結果。不過，企業仍可接受一定程度的誤差量。在驗證過程中，我們想要確保模型預測誤差等於或高於商業容忍度。因此，在「問題編寫」階段的週期開頭，就必須設定誤差容忍度。

### 一般評估技術
有各種方法可測量和量化預測誤差。在本節，我們將專注於討論有關時間序列的預測技巧，尤其是能源需求預測。

#### [MAPE](https://en.wikipedia.org/wiki/Mean_absolute_percentage_error)
MAPE (Mean Absolute Percentage Error) 代表「平均絕對百分比誤差」。我們利用 MAPE 來計算每一個預測點和該點的實際值之間的差異。接著，我們計算差異相對於實際值的比例，以量化每個點的誤差。在最後一個步驟中，我們計算這些值的平均。MAPE 使用的數學公式如下所示︰

![MAPE 公式](media/cortana-analytics-playbook-demand-forecasting-energy/mape-formula.png) *其中 A<sub>t</sub> 是實際值，F<sub>t</sub> 是預測值，而 n 是預測時間範圍。*

## Deployment
一旦完成模型化階段，也已驗證模型的效能，我們就可以開始進入部署階段。就此而言，部署是指讓客戶在模型上大規模執行實際預測來運用模型。部署概念是 Azure ML 中的關鍵，因為我們的主要目標是不斷地引用預測，而不是只從資料找到領悟而已。在部署階段，我們讓模型開始被大規模運用。

在能源需求預測方面，我們的目標是引用連續和定期的預測，同時確保模型可取得最新的資料，並將預測的資料傳回給取用的用戶端。

### Web 服務部署
在 Azure ML 中，主要的可部署建置組塊是 Web 服務。這是在雲端中利用預測模型的最有效方式。Web 服務封裝模型，並以 [RESTful](http://www.restapitutorial.com/) API (應用程式開發介面) 來包裝它。API 可以做為任何用戶端程式碼的一部分，如下圖所示。

![Web 服務部署和取用](media/cortana-analytics-playbook-demand-forecasting-energy/web-service-deployment-and-consumption.png)

由此可知，Web 服務是部署在 Cortana Analytics Suite 雲端，然後透過其公開的 REST API 端點來叫用。位於不同網域的各種不同的用戶端，可以透過 Web API 服務來同時叫用服務。Web 服務也可以擴大來支援數千個同時的呼叫。

### 典型的解決方案架構
在部署能源需求預測解決方案時，我們的興趣是部署端對端解決方案，超越預測 Web 服務，並加速整個資料流。當我們叫用新的預測時，我們必須確定可供應最新的資料特徵給模型。這表示需要不斷地擷取、處理及轉換新收集的原始資料，成為賴以建立模型的必要特徵。同時，我們也想要將預測的資料提供給最終取用的用戶端使用。下圖顯示範例資料流循環 (或資料管線)：

![能源需求預測的端對端資料流](media/cortana-analytics-playbook-demand-forecasting-energy/energy-demand-forecase-end-data-flow.png)

這些是能源需求預測週期內進行的步驟︰
1.  數百萬個已部署的資料計量器不斷地即時產生用電量資料。
2.  這項資料收集後上傳至雲端儲存機制 (例如 Azure Blob)。
3.  在處理之前，原始資料先彙總至企業所定義的變電站或區域層級。
4.  接著進行特徵處理 (請參閱「資料準備和特徵處理」)，並產生模型訓練和評分所需的資料 – 特徵集資料儲存在資料庫 (例如 SQL Azure)。
5.  叫用重新訓練服務來重新訓練預測模型 – 更新後的模型會持續保存，可供評分 Web 服務使用。
6.  依符合所需預測頻率的排程來叫用評分 Web 服務。
7.  預測的資料會儲存在最終取用的用戶端可存取的資料庫。
8.  取用的用戶端會擷取預測值，將它返回套用到電網，然後根據所需的使用案例來利用它。

請務必注意，這整個週期完全自動化，並依排程執行。可利用工具來完成此資料循環的整個協調流程，例如 [Azure Data Factory](http://azure.microsoft.com/services/data-factory/)。

### 端對端部署架構
為了實際地在 Cortana Analytics 上部署能源需求預測解決方案，我們必須確定已建立並正確設定必要的元件。

下圖說明實作並協調上述資料流循環的典型 Cortana Analytics 架構：

![端對端部署架構](media/cortana-analytics-playbook-demand-forecasting-energy/architecture.png)

如需每個元件和整個架構的詳細資訊，請參閱「能源解決方案範本」。

<!---HONumber=AcomDC_0316_2016-->